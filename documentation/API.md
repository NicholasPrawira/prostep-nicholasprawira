# API Documentation

## Base URL

Development: `http://localhost:8000`
Production: `https://your-backend-domain.vercel.app`

## Endpoints

### 1. Health Check

**Endpoint**: `GET /health`

**Description**: Check if API is running

**Response** (200 OK):
```json
{
  "status": "API is running"
}
```

**Example**:
```bash
curl http://localhost:8000/health
```

---

### 2. Search Images

**Endpoint**: `GET /search`

**Description**: Search for images by text description

**Query Parameters**:

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `q` | string | Yes | Search query (min 1 character) |

**Response** (200 OK):
```json
{
  "query": "anak-anak di sekolah",
  "results": [
    {
      "prompt": "Anak-anak sedang belajar di kelas dengan guru memberikan pelajaran",
      "image_url": "https://example.com/image1.jpg",
      "clipscore": 0.334,
      "similarity": 0.540
    },
    {
      "prompt": "Siswa-siswi bermain di halaman sekolah saat istirahat",
      "image_url": "https://example.com/image2.jpg",
      "clipscore": 0.273,
      "similarity": 0.504
    }
  ]
}
```

**Response** (404 Not Found):
```json
{
  "detail": "No similar images found."
}
```

**Response** (500 Internal Server Error):
```json
{
  "detail": "Error message describing what went wrong"
}
```

**Example**:
```bash
curl "http://localhost:8000/search?q=anak-anak%20di%20sekolah"
```

**JavaScript/TypeScript**:
```typescript
const query = "anak-anak di sekolah";
const response = await fetch(`http://localhost:8000/search?q=${encodeURIComponent(query)}`);
const data = await response.json();
console.log(data.results);
```

---

## Response Models

### ImageResult

```typescript
{
  prompt: string;           // Original image prompt
  image_url: string;        // URL to image
  clipscore: number;        // CLIP model quality score (0-1)
  similarity: number;       // Semantic similarity to query (0-1)
}
```

### SearchResponse

```typescript
{
  query: string;           // The search query
  results: ImageResult[];  // Array of up to 5 results
}
```

---

## Error Codes

| Code | Message | Cause |
|------|---------|-------|
| 200 | OK | Request successful |
| 404 | No similar images found | No results match the query |
| 422 | Unprocessable Entity | Invalid query parameter (empty or missing) |
| 500 | Internal Server Error | Backend/database error |

---

## Usage Examples

### JavaScript/Fetch

```typescript
import { SearchResponse } from './types'

async function searchImages(query: string) {
  try {
    const response = await fetch(
      `http://localhost:8000/search?q=${encodeURIComponent(query)}`
    )
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`)
    }
    
    const data: SearchResponse = await response.json()
    return data.results
  } catch (error) {
    console.error('Search failed:', error)
    throw error
  }
}

// Usage
const results = await searchImages("anak-anak bermain")
console.log(results)
```

### Python/Requests

```python
import requests

BASE_URL = "http://localhost:8000"

def search_images(query: str):
    response = requests.get(
        f"{BASE_URL}/search",
        params={"q": query}
    )
    response.raise_for_status()
    return response.json()

# Usage
results = search_images("anak-anak bermain")
print(results)
```

### cURL

```bash
curl -X GET "http://localhost:8000/search?q=anak-anak%20bermain"
curl http://localhost:8000/health
```

---

## Rate Limiting

Currently no rate limiting implemented. For production, consider adding:
- Redis cache
- Request throttling
- User authentication

---

## CORS Headers

All requests support CORS headers:
```
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, OPTIONS
Access-Control-Allow-Headers: Content-Type
```

---

## Performance Metrics

- Average response time: ~500ms (first query, model loading)
- Subsequent queries: ~100-200ms
- Maximum results per query: 5 (configurable)
- Search accuracy: Based on semantic similarity (0-1 scale)

---

## Versioning

Current API Version: 1.0.0

Documented at: `/docs` (Swagger UI auto-generated by FastAPI)
